<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>Časové řady z dat Search Console</title>

  <meta property="description" itemprop="description" content="Jako první na vás v Search Consoli vyskočí graf výkonu webu v čase. Časové řady ze Seaerch Console jdou ale vizualizovat o dost lépe a jdou z nich pak vypozorovat zajímavé věci."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2022-04-18"/>
  <meta property="article:created" itemprop="dateCreated" content="2022-04-18"/>
  <meta name="article:author" content="Marek Prokop"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Časové řady z dat Search Console"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Jako první na vás v Search Consoli vyskočí graf výkonu webu v čase. Časové řady ze Seaerch Console jdou ale vizualizovat o dost lépe a jdou z nich pak vypozorovat zajímavé věci."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Časové řady z dat Search Console"/>
  <meta property="twitter:description" content="Jako první na vás v Search Consoli vyskočí graf výkonu webu v čase. Časové řady ze Seaerch Console jdou ale vizualizovat o dost lépe a jdou z nich pak vypozorovat zajímavé věci."/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","draft"]}},"value":[{"type":"character","attributes":{},"value":["Časové řady z dat Search Console"]},{"type":"character","attributes":{},"value":["Jako první na vás v Search Consoli vyskočí graf výkonu webu v čase. Časové řady ze Seaerch Console jdou ale vizualizovat o dost lépe a jdou z nich pak vypozorovat zajímavé věci.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","affiliation_url"]}},"value":[{"type":"character","attributes":{},"value":["Marek Prokop"]},{"type":"character","attributes":{},"value":["PROKOP software s.r.o."]},{"type":"character","attributes":{},"value":["https://www.prokopsw.cz/cs"]}]}]},{"type":"character","attributes":{},"value":["2022-04-18"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"logical","attributes":{},"value":[true]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["data-raw/sc-date-page-query.rds","data-raw/sc-date-page.rds","data-raw/sc-date-query.rds","data-raw/sc-date.rds","search-console-timeline_files/anchor-4.2.2/anchor.min.js","search-console-timeline_files/bowser-1.9.3/bowser.min.js","search-console-timeline_files/distill-2.2.21/template.v2.js","search-console-timeline_files/figure-html5/unnamed-chunk-10-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-11-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-12-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-13-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-14-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-15-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-16-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-17-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-18-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-19-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-20-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-21-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-22-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-23-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-24-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-25-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-26-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-27-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-28-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-29-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-30-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-31-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-32-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-33-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-34-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-35-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-36-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-37-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-38-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-39-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-4-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-40-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-41-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-42-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-5-1.png","search-console-timeline_files/figure-html5/unnamed-chunk-8-1.png","search-console-timeline_files/header-attrs-2.13/header-attrs.js","search-console-timeline_files/jquery-3.6.0/jquery-3.6.0.js","search-console-timeline_files/jquery-3.6.0/jquery-3.6.0.min.js","search-console-timeline_files/jquery-3.6.0/jquery-3.6.0.min.map","search-console-timeline_files/pagedtable-1.1/css/pagedtable.css","search-console-timeline_files/pagedtable-1.1/js/pagedtable.js","search-console-timeline_files/popper-2.6.0/popper.min.js","search-console-timeline_files/tippy-6.2.7/tippy-bundle.umd.min.js","search-console-timeline_files/tippy-6.2.7/tippy-light-border.css","search-console-timeline_files/tippy-6.2.7/tippy.css","search-console-timeline_files/tippy-6.2.7/tippy.umd.min.js","search-console-timeline_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="search-console-timeline_files/header-attrs-2.13/header-attrs.js"></script>
  <link href="search-console-timeline_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
  <script src="search-console-timeline_files/pagedtable-1.1/js/pagedtable.js"></script>
  <script src="search-console-timeline_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="search-console-timeline_files/popper-2.6.0/popper.min.js"></script>
  <link href="search-console-timeline_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="search-console-timeline_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="search-console-timeline_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="search-console-timeline_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="search-console-timeline_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="search-console-timeline_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="search-console-timeline_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Časové řady z dat Search Console","description":"Jako první na vás v Search Consoli vyskočí graf výkonu webu v čase. Časové řady ze Seaerch Console jdou ale vizualizovat o dost lépe a jdou z nich pak vypozorovat zajímavé věci.","authors":[{"author":"Marek Prokop","authorURL":"#","affiliation":"PROKOP software s.r.o.","affiliationURL":"https://www.prokopsw.cz/cs","orcidID":""}],"publishedDate":"2022-04-18T00:00:00.000+02:00","citationText":"Prokop, 2022"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Časové řady z dat Search Console</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>Jako první na vás v Search Consoli vyskočí graf výkonu webu v čase. Časové řady ze Seaerch Console jdou ale vizualizovat o dost lépe a jdou z nich pak vypozorovat zajímavé věci.</p></p>
</div>

<div class="d-byline">
  Marek Prokop  (PROKOP software s.r.o.)<a href="https://www.prokopsw.cz/cs" class="uri">https://www.prokopsw.cz/cs</a>
  
<br/>2022-04-18
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#příprava">Příprava</a>
<ul>
<li><a href="#potřebné-balíčky">Potřebné balíčky</a></li>
<li><a href="#základní-parametry">Základní parametry</a></li>
<li><a href="#načtení-vstupních-dat">Načtení vstupních dat</a></li>
<li><a href="#nekonzistence-dat-search-console">Nekonzistence dat Search Console</a></li>
</ul></li>
<li><a href="#vizualizace-časových-řad">Vizualizace časových řad</a>
<ul>
<li><a href="#základní-metriky">Základní metriky</a></li>
<li><a href="#počet-stránek-a-dotazů">Počet stránek a dotazů</a></li>
<li><a href="#zoomování-grafu">Zoomování grafu</a></li>
</ul></li>
<li><a href="#granularita-období">Granularita období</a>
<ul>
<li><a href="#agregace-za-kalendářní-období">Agregace za kalendářní období</a></li>
<li><a href="#průměr-za-kalendářní-týdny">Průměr za kalendářní týdny</a></li>
<li><a href="#rozsah-hodnot-za-týden">Rozsah hodnot za týden</a></li>
<li><a href="#klouzavý-průměr-moving-average">Klouzavý průměr (moving average)</a></li>
<li><a href="#regrese">Regrese</a></li>
</ul></li>
<li><a href="#poměrové-metriky">Poměrové metriky</a></li>
<li><a href="#metriky-podle-pozic">Metriky podle pozic</a>
<ul>
<li><a href="#počet-dotazů-podle-intervalů-pozic">Počet dotazů podle intervalů pozic</a></li>
<li><a href="#počet-vstupních-stránek-podle-intervalů-pozic">Počet vstupních stránek podle intervalů pozic</a></li>
<li><a href="#imprese-podle-intervalů-pozic">Imprese podle intervalů pozic</a></li>
</ul></li>
<li><a href="#porovnání-metrik-s-předešlým-obdobím-nebo-rokem">Porovnání metrik s předešlým obdobím nebo rokem</a>
<ul>
<li><a href="#meziroční-porovnání-yoy">Meziroční porovnání (YoY)</a></li>
<li><a href="#posledních-12-týdnů-a-12-týdnů-před-tím">Posledních 12 týdnů a 12 týdnů před tím</a></li>
<li><a href="#autokorelace">Autokorelace</a></li>
</ul></li>
<li><a href="#dny-v-týdnu">Dny v týdnu</a>
<ul>
<li><a href="#dekompozice-časové-řady">Dekompozice časové řady</a></li>
</ul></li>
<li><a href="#segmentace-podle-url">Segmentace podle URL</a>
<ul>
<li><a href="#typ-stránky-rubriky-vs.-články">Typ stránky: rubriky vs. články</a></li>
<li><a href="#rubriky">Rubriky</a></li>
</ul></li>
</ul>
</nav>
</div>
<p>Článek je hodně dlouhý, protože sestavit a vizualizovat časové řady (time series) z dat Search Console jde mnoha způsoby a není úplně triviální si vybrat ty, které dávají pro daný účel smysl. Ukážu zde všechny, které bežně používám, i ty, které používám jen výjimečně nebo skoro vůbec.</p>
<p>Kód v jazyce R jsem se snažil napsat tak, aby byl funkční, čistý, srozumitelný a hlavně snadno a univerzálně znovupoužitelný. Časem asi na analýzu dat Search Console udělám samostatný balíček, ale do té by musí stačit tohle.</p>
<p>Na druhou stranu má článek i čistě metodickou, na programovacím jazyce nezávislou rovinu. Některé uvedené časové řady a jejich vizualizace jdou vytvořit i jinak, např. v Data Studiu (na příklad odkazuju dál) nebo v Google Sheets. I bez znalosti R jde tedy článek využít jako vzorník výstupů, které jdou z dat Search Console různými prostředky udělat a které dávají určitý smysl.</p>
<p>Všechny ukázky čerpají z dat webu <a href="https://www.glamourcabaret.cz/">Glamour Cabaret</a> Alžběty Faltysové. Jako hobby projekt bez větších investic sice neohromí gigantickými čísly, ale zároveň hezky ukazuje některé vzorce typické pro přirozeně a dobře budovaný obsah se zajímavým potenciálem dalšího růstu. Alžbětě moc děkuju, že mi data pro článek poskytla.</p>
<p>Pro jistotu upozorňuju, že tenhle článek se primárně zabývá konkstrukcí a vizualizací časových řad z dat Search Console, nikoli jejich detailní analýzou. Té se budu věnnovat někdy jindy.</p>
<h2 id="příprava">Příprava</h2>
<h3 id="potřebné-balíčky">Potřebné balíčky</h3>
<p>Jako vždy <em>tidyverse</em>, <em>searchConsoleR</em> pro práci se Search Consolí, <em>lubridate</em> pro práci s daty a časem. Balíček <em>feasts</em> je zde jen pro dekompozici časové řady na trend, sezónnost a šum, a balíček <em>slider</em> umožňuje výpočet klouzavých průměrů. Balíček <em>urltools</em> slouží k rozložení URL na složky a používám ho k segentaci dat podle stránek.</p>
<p>Dlužno dodat, že balíčky specializované na časové řady zde používám jen v nejnutnější míře a zatím mi to tak vyhovuje. Na druhou stranu přiznávám, že některé věci by šly řešit elegantněji plným nasazením specializovaných balíčků typu <a href="https://business-science.github.io/timetk/index.html">timetk</a>, <a href="https://www.tsbox.help/reference/index.html">tsbox</a>, <a href="https://tsibble.tidyverts.org/index.html">tsibble</a> apod.</p>
<p>Poslední řádek nastavuje začátek týdne na pondělí pro balíček <em>lubridate</em>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://code.markedmondson.me/searchConsoleR/'>searchConsoleR</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://lubridate.tidyverse.org'>lubridate</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://feasts.tidyverts.org/'>feasts</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/DavisVaughan/slider'>slider</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/Ironholds/urltools/'>urltools</a></span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span><span class='op'>(</span>lubridate.week.start <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="základní-parametry">Základní parametry</h3>
<p>Kdykoli pracuju s daty Search Console, nejprve definuju parametry, které určují, jaká vstupní data chci získat. Konkrétně:</p>
<ul>
<li><code>sc_site</code> – z kterého webu,</li>
<li><code>sc_country</code> – ze které země má hledání pocházet (používám vždy, pokud web primárně cílí na jednu zemi),</li>
<li><code>date_from</code>, <code>date_to</code> – za jaké období data chci.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_site</span> <span class='op'>&lt;-</span> <span class='st'>"https://www.glamourcabaret.cz/"</span>
<span class='va'>sc_country</span> <span class='op'>&lt;-</span> <span class='st'>"cze"</span>
<span class='va'>date_from</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2020-11-01"</span><span class='op'>)</span>
<span class='va'>date_to</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2022-04-10"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="nastavení-časových-parametrů-balíčkem-lubridate">Nastavení časových parametrů balíčkem <em>lubridate</em></h4>
<p>Někdy jsem líný hledat v kalendáři vhodná data, nebo chci, aby se mi parametry <code>date_from</code> a <code>date_to</code> automaticky aktualizovaly. Na to se hodí balíček <em>lubridate</em>.</p>
<p>Pro Search Consoli typicky chci datum před třemi dny, protože poslední tři dny ještě data v Search Consoli nejsou finální.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://lubridate.tidyverse.org/reference/now.html'>today</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>3</span>
</code></pre>
</div>
<pre><code>[1] &quot;2022-04-15&quot;</code></pre>
</div>
<p>Když chci třeba poslední 4 celé kalendářní týdny, udělám to takhle:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>period_end</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='fu'><a href='https://lubridate.tidyverse.org/reference/now.html'>today</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>2</span>, unit <span class='op'>=</span> <span class='st'>"week"</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1</span>
<span class='va'>period_start</span> <span class='op'>&lt;-</span> <span class='va'>period_end</span> <span class='op'>-</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/period.html'>weeks</a></span><span class='op'>(</span><span class='fl'>4</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>1</span>

<span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"Od"</span>, <span class='fu'><a href='https://rdrr.io/r/base/format.html'>format</a></span><span class='op'>(</span><span class='va'>period_start</span>, <span class='st'>"%x (%A)"</span><span class='op'>)</span>, <span class='st'>"do"</span>, <span class='fu'><a href='https://rdrr.io/r/base/format.html'>format</a></span><span class='op'>(</span><span class='va'>period_end</span>, <span class='st'>"%x (%A)"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Od 14.3.2022 (pondělí) do 10.4.2022 (neděle)</code></pre>
</div>
<p>Obdobně můžu určit třeba posledních 6 celých kalendářních měsíců:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>period_end</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='fu'><a href='https://lubridate.tidyverse.org/reference/now.html'>today</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>2</span>, unit <span class='op'>=</span> <span class='st'>"month"</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1</span>
<span class='va'>period_start</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/mplus.html'>add_with_rollback</a></span><span class='op'>(</span><span class='va'>period_end</span>, <span class='fu'><a href='https://rdrr.io/r/base/weekday.POSIXt.html'>months</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>6</span><span class='op'>)</span>, roll_to_first <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"Od"</span>, <span class='fu'><a href='https://rdrr.io/r/base/format.html'>format</a></span><span class='op'>(</span><span class='va'>period_start</span>, <span class='st'>"%x"</span><span class='op'>)</span>, <span class='st'>"do"</span>, <span class='fu'><a href='https://rdrr.io/r/base/format.html'>format</a></span><span class='op'>(</span><span class='va'>period_end</span>, <span class='st'>"%x"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Od 1.10.2021 do 31.3.2022</code></pre>
</div>
<p>Nebo poslední celý rok (ten ale nebude po dubnu běžného roku fungovat, protože Search Console archivuje jen posledních 16 měsíců):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>period_end</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='fu'><a href='https://lubridate.tidyverse.org/reference/now.html'>today</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>2</span>, unit <span class='op'>=</span> <span class='st'>"year"</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1</span>
<span class='va'>period_start</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='va'>period_end</span>, <span class='st'>"year"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"Od"</span>, <span class='fu'><a href='https://rdrr.io/r/base/format.html'>format</a></span><span class='op'>(</span><span class='va'>period_start</span>, <span class='st'>"%x"</span><span class='op'>)</span>, <span class='st'>"do"</span>, <span class='fu'><a href='https://rdrr.io/r/base/format.html'>format</a></span><span class='op'>(</span><span class='va'>period_end</span>, <span class='st'>"%x"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Od 1.1.2021 do 31.12.2021</code></pre>
</div>
<h3 id="načtení-vstupních-dat">Načtení vstupních dat</h3>
<p>Pak si podle potřeby definuju funkci, která při prvním zavolání s konkrétními parametry načte data funkcí <code>search_analytics</code> z balíčku <em>searchConsoleR</em> a uloží je do souboru. Při druhém a dalším zavolání se stejnými parametry již načítá data z uloženého souboru. To má dvě výhody:</p>
<ul>
<li>Opakované načtení dat je mnohem rychlejší.</li>
<li>Skript pokaždé pracuje se stejnými daty, i když už ze Search Console zmizela (jsou tam data jen za posledních 16 měsíců).</li>
</ul>
<p>A dvě nevýhody:</p>
<ul>
<li>Uložená data zabírají místo na disku.</li>
<li>Pokud potřebuju čerstvá data nebo s jinými parametry, musím soubory z disku odstranit.</li>
</ul>
<p>Pro účely tohoto zápisku si funkci definuju velmi jednoduše. Jako jediný parametr má dimenze, vše ostatní se bere přímo z globálních objektů definovaných výše. Data ukládá do podsložky <code>raw-data</code>, která již v aktuální složce musí existovat. Pro jiné účely může být funkce složitější.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>read_sc</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>dimensions</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>rds_path</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span>
    <span class='st'>"."</span>, <span class='st'>"data-raw"</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"sc-"</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>dimensions</span>, collapse <span class='op'>=</span> <span class='st'>"-"</span><span class='op'>)</span>, <span class='st'>".rds"</span><span class='op'>)</span>
  <span class='op'>)</span>
  <span class='va'>row_limit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>date_to</span> <span class='op'>-</span> <span class='va'>date_from</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>500</span> <span class='op'>*</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>dimensions</span><span class='op'>)</span><span class='op'>)</span>

  <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/files.html'>file.exists</a></span><span class='op'>(</span><span class='va'>rds_path</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='fu'><a href='https://rdrr.io/pkg/searchConsoleR/man/search_analytics.html'>search_analytics</a></span><span class='op'>(</span>
      siteURL <span class='op'>=</span> <span class='va'>sc_site</span>,
      startDate <span class='op'>=</span> <span class='va'>date_from</span>,
      endDate <span class='op'>=</span> <span class='va'>date_to</span>,
      dimensions <span class='op'>=</span> <span class='va'>dimensions</span>,
      dimensionFilterExp <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"country=="</span>, <span class='va'>country</span><span class='op'>)</span>,
      rowLimit <span class='op'>=</span> <span class='va'>row_limit</span>
    <span class='op'>)</span> |&gt;
      <span class='fu'><a href='https://readr.tidyverse.org/reference/read_rds.html'>write_rds</a></span><span class='op'>(</span><span class='va'>rds_path</span>, compress <span class='op'>=</span> <span class='st'>"gz"</span><span class='op'>)</span>
  <span class='op'>}</span>
  <span class='fu'><a href='https://readr.tidyverse.org/reference/read_rds.html'>read_rds</a></span><span class='op'>(</span><span class='va'>rds_path</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Nakonec si opravdu stáhnu resp. ze souborů načtu všechna data, která budu ze Search Console potřebovat. V praxi se s tím musí opatrně, protože tahání více dimenzí za delší období z API může trvat docela dlouho. Když nevím, jak budou data konkrétního webu veliká, zkusím nejprve stáhnout jeden typický den nebo týden a podle toho se rozhodnu.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/searchConsoleR/man/scr_auth.html'>scr_auth</a></span><span class='op'>(</span>email <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Sys.getenv.html'>Sys.getenv</a></span><span class='op'>(</span><span class='st'>"MY_GOOGLE_ACCOUNT"</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>sc_by_date</span> <span class='op'>&lt;-</span> <span class='fu'>read_sc</span><span class='op'>(</span><span class='st'>"date"</span><span class='op'>)</span>
<span class='va'>sc_by_date_page</span> <span class='op'>&lt;-</span> <span class='fu'>read_sc</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"date"</span>, <span class='st'>"page"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>sc_by_date_query</span> <span class='op'>&lt;-</span> <span class='fu'>read_sc</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"date"</span>, <span class='st'>"query"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>sc_by_date_page_query</span> <span class='op'>&lt;-</span> <span class='fu'>read_sc</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"date"</span>, <span class='st'>"page"</span>, <span class='st'>"query"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Výsledkem je několik dataframů, jejichž strukturu a obsah si mohu rychle zkontrolovat.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://pillar.r-lib.org/reference/glimpse.html'>glimpse</a></span><span class='op'>(</span><span class='va'>sc_by_date</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Rows: 498
Columns: 5
$ date        &lt;date&gt; 2020-11-28, 2020-11-29, 2020-11-30, 2020-12-01,~
$ clicks      &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ~
$ impressions &lt;int&gt; 0, 0, 0, 4, 5, 1, 0, 0, 1, 0, 2, 10, 4, 6, 3, 6,~
$ ctr         &lt;dbl&gt; 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0~
$ position    &lt;dbl&gt; 0.000000, 0.000000, 0.000000, 16.500000, 8.40000~</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://pillar.r-lib.org/reference/glimpse.html'>glimpse</a></span><span class='op'>(</span><span class='va'>sc_by_date_page</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Rows: 18,626
Columns: 6
$ date        &lt;date&gt; 2021-12-19, 2021-07-02, 2021-04-19, 2021-07-05,~
$ page        &lt;chr&gt; &quot;https://www.glamourcabaret.cz/znacky/hermes&quot;, &quot;~
$ clicks      &lt;int&gt; 30, 13, 12, 12, 11, 11, 10, 8, 8, 8, 8, 8, 7, 7,~
$ impressions &lt;int&gt; 657, 272, 406, 100, 374, 768, 295, 91, 226, 105,~
$ ctr         &lt;dbl&gt; 0.04566210, 0.04779412, 0.02955665, 0.12000000, ~
$ position    &lt;dbl&gt; 3.713851, 3.669118, 5.211823, 3.470000, 4.687166~</code></pre>
</div>
<p>A tak dále. Výsledný dataframe vždy obsahuje dimenzi <em>date</em>, případné další dimenze a čtyři základní metriky, které Search Console eviduje.</p>
<h3 id="nekonzistence-dat-search-console">Nekonzistence dat Search Console</h3>
<p>Teoreticky by stačilo stáhnout jenom poslední dataset <code>sc_by_date_page_query</code>, protože z něho by mělo jít všechno ostatní agregovat, jenže Search Console vrací různě upravené výsledky podle toho, zda si vyžádáte dimenze <em>page</em> nebo <em>query</em>, takže datasety bez těchto dimenzí mají přesnější čísla než data sety s nimi. Podrobněji to dokumentuju v <a href="https://github.com/MarekProkop/search-analytics-test/blob/master/search-analytics-test.md">tomhle testu</a>.</p>
<p>Z tohoto důvodu beru základní metriky (imprese, kliky, CTR a pozice) pokud možno jen z datasetu, který nebosahuje dimenze <em>page</em> nebo <em>query</em>. Datasety s těmito dimenzemi používám jen v případě, že potřebuju znát konkrétní stránky nebo jejich počty, resp. konkrétní dotazy nebo jejich počty.</p>
<h2 id="vizualizace-časových-řad">Vizualizace časových řad</h2>
<h3 id="základní-metriky">Základní metriky</h3>
<p>Základní vizualizace, kterou skoro stejně ukazuje i webové rozhraní Search Console, vypadá takto:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>scale_factor</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>sc_by_date</span><span class='op'>$</span><span class='va'>clicks</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>sc_by_date</span><span class='op'>$</span><span class='va'>impressions</span><span class='op'>)</span>
<span class='va'>sc_by_date</span> |&gt;
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>clicks</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"#4285f4"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>impressions</span> <span class='op'>*</span> <span class='va'>scale_factor</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"#5e35b1"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>
    name <span class='op'>=</span> <span class='st'>"clicks"</span>,
    sec.axis <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/sec_axis.html'>sec_axis</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>.</span> <span class='op'>/</span> <span class='va'>scale_factor</span>, name <span class='op'>=</span> <span class='st'>"impressions"</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>
    axis.title.y.left <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"#4285f4"</span><span class='op'>)</span>,
    axis.text.y.left <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"#4285f4"</span><span class='op'>)</span>,
    axis.title.y.right <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"#5e35b1"</span><span class='op'>)</span>,
    axis.text.y.right <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"#5e35b1"</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-11-1.png" width="624" /></p>
</div>
<p>Tenhle graf má duální osu Y (čili dvě různé osy Y), což patří spíš do rejstříku „manažerských“ grafů, které se ve vážnější analytice z dobrých důvodů moc nepoužívájí. V R se místo toho většinou používají fasety (grafy vedle sebe a/nebo pod sebou), které nezkreslují měřítko, nepletou čtenáře co je co a navíc se do nich vejdou víc než dvě metriky, když je to potřeba.</p>
<p>Protože budu v dalším kódu potřebovat podobné fasetové grafy často, připravím si na ně dvě funkce, abych nepsal opakovaně stejný kód.</p>
<p>První funkce <code>sc_reshape</code> provede tři věci:</p>
<ol type="1">
<li>Přesune imprese před kliky, protože tohle pořadí mi připadá logičtější.</li>
<li>Převede širokou tabulku na dlouhou, tj. hodnoty metrik v druhém až posledním sloupci sloučí do jediného sloupce <code>value</code> (to je ve funkci <code>pivot_longer default</code>) a jejich názvy do sloupce <code>metric</code>.</li>
<li>Převede názvy metrik na typ <em>factor</em>, aby se fasety v grafu správně seřadily.</li>
</ol>
<p>K druhému bodu vysvětlení: Fasety v principu zobrazují jen jednu proměnnou ve více kategoriích, takže se tabulka musí předem převést na dlouhý formát, ve kterém se do jednoho sloupce dostanou názvy metrik jako kategorie a do druhého sloupce hodnoty všech metrik. K tomu slouží funkce <code>pivot_longer</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_reshape</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='st'>"impressions"</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>df</span> <span class='op'>&lt;-</span> <span class='va'>df</span> |&gt; 
      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/relocate.html'>relocate</a></span><span class='op'>(</span><span class='va'>impressions</span>, .before <span class='op'>=</span> <span class='va'>clicks</span><span class='op'>)</span>
  <span class='op'>}</span>
  <span class='va'>df</span> |&gt;
    <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fl'>2</span><span class='op'>:</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/everything.html'>last_col</a></span><span class='op'>(</span><span class='op'>)</span>, names_to <span class='op'>=</span> <span class='st'>"metric"</span><span class='op'>)</span> |&gt;
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>metric <span class='op'>=</span> <span class='fu'><a href='https://forcats.tidyverse.org/reference/as_factor.html'>as_factor</a></span><span class='op'>(</span><span class='va'>metric</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Druhá funkce vykreslí samotný graf časových řad. Protože budu používat různé časové rozpětí a různé časové jednotky, je malinko složitější, aby se tomu přizpůsobila.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_plot</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span>
  <span class='va'>df</span>, <span class='va'>x_breaks</span> <span class='op'>=</span> <span class='st'>"3 months"</span>, <span class='va'>x_labels</span> <span class='op'>=</span> <span class='st'>"%b %y"</span>, <span class='va'>x_minor_breaks</span> <span class='op'>=</span> <span class='st'>"month"</span>,
  <span class='va'>strip_pos</span> <span class='op'>=</span> <span class='st'>"right"</span>
<span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>df</span> |&gt; 
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes_.html'>aes_string</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span>, y <span class='op'>=</span> <span class='st'>"value"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_date.html'>scale_x_date</a></span><span class='op'>(</span>
      date_breaks <span class='op'>=</span> <span class='va'>x_breaks</span>, date_labels <span class='op'>=</span> <span class='va'>x_labels</span>,
      date_minor_breaks <span class='op'>=</span> <span class='va'>x_minor_breaks</span>, expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span><span class='fl'>0.01</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span>
      <span class='op'>~</span> <span class='va'>metric</span>, ncol <span class='op'>=</span> <span class='fl'>1</span>, scales <span class='op'>=</span> <span class='st'>"free_y"</span>, strip.position <span class='op'>=</span> <span class='va'>strip_pos</span>
    <span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_gray</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Ve fasetách vypadají časové řady všech čtyř základních metrik takhle:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_by_date</span> |&gt;
  <span class='fu'>sc_reshape</span><span class='op'>(</span><span class='op'>)</span> |&gt;
  <span class='fu'>sc_plot</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-14-1.png" width="624" /></p>
</div>
<h4 id="výklad-dat">Výklad dat</h4>
<p>Už tenhle graf jde nějak interpretovat:</p>
<ul>
<li>Na začátku období neměl web z Googlu skoro žádnou návštěvnost, ale po cca třech měsících se začal postupně zlepšovat a zřejmě se zlepšuje pořád.</li>
<li>CTR v prvním měsíci skákalo až k 50 %, což s nepatrným počtem impresí naznačuje, že web se v té době zobrazoval jen na extrémně nekonkurenční dotazy, které neměly ve výsledcích hledání jinou dobrou odpověď. To se postupně změnilo, CTR kleslo, a to naznačuje, že přibyly nějaké normálnější dotazy.</li>
<li>Tuto hypotézu podporuje i křivka průměrných pozic. Na začátku šíleně skáče, což je typické pro velmi malý počet dotazů, později se uklidní, takže se počet dotazů asi zvýšil.</li>
<li>Z toho všecho bych usoudil, že web začínal s malým objemem obsahu a postupně se zvětšuje. Je to ale jen hypotéza, kterou je třeba podpořit dalšími daty.</li>
</ul>
<h3 id="počet-stránek-a-dotazů">Počet stránek a dotazů</h3>
<p>Aby šla data lépe interpretovat, skoro vždy přidávám ještě dvě další časové řady – počet vstupních stránek a počet unikátních dotazů. K tomu jsem si stáhl ze Search Sonsole dva další datasety, vstupní stránky podle dnů (<code>sc_by_date_page</code>) dotazy podle dnů (<code>sc_by_date_query</code>). Nyní z nich funkcemi <code>group_by</code> a <code>summarise</code> spočítám počty unikátních stránek resp. dotazů za den a funkcí <code>left_join</code> je připojím k původní tabulce metrik. Výsledek uložím do objektu <code>sc_all_metrics_by_date</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_all_metrics_by_date</span> <span class='op'>&lt;-</span> <span class='va'>sc_by_date</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span>
    <span class='va'>sc_by_date_page</span> |&gt;
      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>date</span><span class='op'>)</span> |&gt;
      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>pages <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>,
    by <span class='op'>=</span> <span class='st'>"date"</span>
  <span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span>
    <span class='va'>sc_by_date_query</span> |&gt;
      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>date</span><span class='op'>)</span> |&gt;
      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>queries <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>,
    by <span class='op'>=</span> <span class='st'>"date"</span>
  <span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    pages <span class='op'>=</span> <span class='fu'><a href='https://tidyr.tidyverse.org/reference/replace_na.html'>replace_na</a></span><span class='op'>(</span><span class='va'>pages</span>, <span class='fl'>0</span><span class='op'>)</span>,
    queries <span class='op'>=</span> <span class='fu'><a href='https://tidyr.tidyverse.org/reference/replace_na.html'>replace_na</a></span><span class='op'>(</span><span class='va'>queries</span>, <span class='fl'>0</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Výslední tabulka vypadá takhle:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://pillar.r-lib.org/reference/glimpse.html'>glimpse</a></span><span class='op'>(</span><span class='va'>sc_all_metrics_by_date</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Rows: 498
Columns: 7
$ date        &lt;date&gt; 2020-11-28, 2020-11-29, 2020-11-30, 2020-12-01,~
$ clicks      &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ~
$ impressions &lt;int&gt; 0, 0, 0, 4, 5, 1, 0, 0, 1, 0, 2, 10, 4, 6, 3, 6,~
$ ctr         &lt;dbl&gt; 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0~
$ position    &lt;dbl&gt; 0.000000, 0.000000, 0.000000, 16.500000, 8.40000~
$ pages       &lt;int&gt; 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 2, 1, 1, 1, 1, ~
$ queries     &lt;int&gt; 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 2, 1, 2, 2, 1, ~</code></pre>
</div>
<p>Graf zobrazím stejně, jako ten se čtyřmi základními metrikami, jen funkcí <code>scale_x_date</code> trochu vyladím rozdělení osy X, aby bylo časové členění přehlednější.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_all_metrics_by_date</span> |&gt;
  <span class='fu'>sc_reshape</span><span class='op'>(</span><span class='op'>)</span> |&gt;
  <span class='fu'>sc_plot</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-17-1.png" width="624" /></p>
</div>
<p>Mimochodem, obdobný graf jde odělat i v Data Studiu. Tady je <a href="https://datastudio.google.com/u/0/reporting/9007c9b8-db68-4138-abcc-b800f0dc42bb/page/MlTqC">příklad reportu</a>, který si můžete zkopírovat a upravit pro své potřeby.</p>
<h3 id="zoomování-grafu">Zoomování grafu</h3>
<p>V druhé polovině grafu za celé období nejsou moc dobře vidět změny CTR a pozic, protože na začátku období mají tyto metriky příliš veliké rozpětí hodnot. Zazoomuju proto na období od začátku srpna 2021 prostým vyfiltrováním řádků, které do grafu vstupují.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_all_metrics_by_date</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>date</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2021-08-01"</span><span class='op'>)</span><span class='op'>)</span> |&gt;
  <span class='fu'>sc_reshape</span><span class='op'>(</span><span class='op'>)</span> |&gt;
  <span class='fu'>sc_plot</span><span class='op'>(</span><span class='st'>"month"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-18-1.png" width="624" /></p>
</div>
<h2 id="granularita-období">Granularita období</h2>
<p>Až dosud jsem časové řady vykresloval po dnech. Pro data související s návštěvností webů je ale typická silná týdenní periodicita a v jejím důsledku grafy bývají hodně zubaté. Existuje několik způsobů, jak je vyhladit. Nejpřirozenější je snížit časovou granularitu a agregovat data za týden, měsíc, nebo ještě delší období. I to lze však udělat více způsoby, např mohu:</p>
<ol type="1">
<li>Sečíst to, co jde sečíst (imprese a kliky) a zprůměrovat to, co sčítat nejde (CTR a pozice) a počty unikátních položek (stránek a dotazů) spočítat znovu. To vše za celé nové časové jednotky, tedy např. za týdny.</li>
<li>Totéž, ale klouzavě. Ke každému dni tedy totéž sečtu, zprůměruju, nebo znovu vypočtu za posledních sedm dní. Bude to sice výpočetně náročnější, protože místo jednou za týden to budu počítat za každý den, ale i když nebude celé období začínat a končit přesně na hranici týdnů (resp. měsíců či jiné časové jednotky), nebude graf na okrajích zkreslený.</li>
<li>Spočítat prosté průměry či mediány všech hodnot za týden či jinou časovou jednotku.</li>
<li>Kromě průměru či mediánu spočítat a hezky vykreslit i pásmo, ve kterém se hodnoty pohybují.</li>
</ol>
<p>Zkusím všechny varianty, ať je vidět, zda a případně jak se liší.</p>
<h3 id="agregace-za-kalendářní-období">Agregace za kalendářní období</h3>
<p>Agregace dat Search Console do delších časových jednotek, tedy typicky týdnů či měsíců případně kvartálů, není úplně triviální.</p>
<ul>
<li>Imprese a kliky se normálně sečtou, tam problém není.</li>
<li>CTR a pozice se musí zprůměrovat váženým průměrem, přičemž vahou jsou imprese. Není to úplně nezbytné, ale je to bezpečnější, protože prostý aritmetický průměr se od váženého někdy liší jen nepatrně a jindy (při velkém rozdílu impresí) hodně.</li>
<li>Počty unikátních stránek a dotazů se musí spočítat funkcí <code>n_distinct</code> za každé dílčí období znovu. Rozdíl ve tvaru křivky sice nebývá moc veliký, ale zato je značný rozdíl ve velikosti hodnot – za den je unikátních dotazů či stránek podstatně méně než za týden nebo měsíc.</li>
</ul>
<p>Pro usnadnění a zpřehlednění výpočtu si připravím několik funkcí.</p>
<p>První funkce agreguje tabulku základních metrik.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_aggregate</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>df</span>, <span class='va'>per</span> <span class='op'>=</span> <span class='st'>"week"</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>df</span> |&gt;
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='st'>"{per}"</span> <span class='op'>:=</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='va'>per</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span><span class='va'>ctr</span><span class='op'>:</span><span class='va'>position</span>, <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/stats/weighted.mean.html'>weighted.mean</a></span><span class='op'>(</span><span class='va'>.x</span>, <span class='va'>impressions</span><span class='op'>)</span><span class='op'>)</span>,
      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span><span class='va'>clicks</span><span class='op'>:</span><span class='va'>impressions</span>, <span class='va'>sum</span><span class='op'>)</span>,
    <span class='op'>)</span> |&gt; 
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/relocate.html'>relocate</a></span><span class='op'>(</span><span class='va'>ctr</span><span class='op'>:</span><span class='va'>position</span>, .after <span class='op'>=</span> <span class='va'>impressions</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='fu'>sc_aggregate</span><span class='op'>(</span><span class='va'>sc_by_date</span>, <span class='st'>"quarter"</span><span class='op'>)</span>
</code></pre>
</div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["quarter"],"name":[1],"type":["date"],"align":["right"]},{"label":["clicks"],"name":[2],"type":["int"],"align":["right"]},{"label":["impressions"],"name":[3],"type":["int"],"align":["right"]},{"label":["ctr"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["position"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"2020-10-01","2":"4","3":"89","4":"0.04494382","5":"9.191011"},{"1":"2021-01-01","2":"80","3":"2608","4":"0.03067485","5":"8.855061"},{"1":"2021-04-01","2":"464","3":"16597","4":"0.02795686","5":"6.794360"},{"1":"2021-07-01","2":"1224","3":"54718","4":"0.02236924","5":"7.350342"},{"1":"2021-10-01","2":"2160","3":"112025","4":"0.01928141","5":"7.175023"},{"1":"2022-01-01","2":"2816","3":"142337","4":"0.01978403","5":"6.819112"},{"1":"2022-04-01","2":"357","3":"17905","4":"0.01993856","5":"6.990896"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<p>Druhá funkce znovu spočítá počty unikátních stránek či dotazů. Předpokládá, že vstupní tabulka obsahuje sloupce <code>date</code> a sloupec řetězců, keré se mají spočítat. Na dalších sloupcích nezáleží.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_recount</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>df</span>, <span class='va'>per</span> <span class='op'>=</span> <span class='st'>"month"</span>, <span class='va'>column</span>, <span class='va'>new_col</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>df</span> |&gt; 
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='st'>"{per}"</span> <span class='op'>:=</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='va'>per</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='st'>"{new_col}"</span> <span class='op'>:=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='op'>{</span><span class='op'>{</span> <span class='va'>column</span> <span class='op'>}</span><span class='op'>}</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='fu'>sc_recount</span><span class='op'>(</span><span class='va'>sc_by_date_page</span>, <span class='st'>"quarter"</span>, <span class='va'>page</span>, <span class='st'>"pages"</span><span class='op'>)</span>
</code></pre>
</div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["quarter"],"name":[1],"type":["date"],"align":["right"]},{"label":["pages"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"2020-10-01","2":"3"},{"1":"2021-01-01","2":"33"},{"1":"2021-04-01","2":"78"},{"1":"2021-07-01","2":"126"},{"1":"2021-10-01","2":"141"},{"1":"2022-01-01","2":"150"},{"1":"2022-04-01","2":"126"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<p>A konečně mohu napsat poslední funkci, která sestaví všechny metriky do jedné tabulky.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_aggregate_all_metrics</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>per</span> <span class='op'>=</span> <span class='st'>"week"</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'>sc_aggregate</span><span class='op'>(</span><span class='va'>sc_by_date</span>, <span class='va'>per</span><span class='op'>)</span> |&gt; 
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='fu'>sc_recount</span><span class='op'>(</span><span class='va'>sc_by_date_page</span>, <span class='va'>per</span>, <span class='va'>page</span>, <span class='st'>"pages"</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='fu'>sc_recount</span><span class='op'>(</span><span class='va'>sc_by_date_query</span>, <span class='va'>per</span>, <span class='va'>query</span>, <span class='st'>"queries"</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
      pages <span class='op'>=</span> <span class='fu'><a href='https://tidyr.tidyverse.org/reference/replace_na.html'>replace_na</a></span><span class='op'>(</span><span class='va'>pages</span>, <span class='fl'>0</span><span class='op'>)</span>,
      queries <span class='op'>=</span> <span class='fu'><a href='https://tidyr.tidyverse.org/reference/replace_na.html'>replace_na</a></span><span class='op'>(</span><span class='va'>queries</span>, <span class='fl'>0</span><span class='op'>)</span>
    <span class='op'>)</span>
<span class='op'>}</span>

<span class='fu'>sc_aggregate_all_metrics</span><span class='op'>(</span><span class='st'>"quarter"</span><span class='op'>)</span>
</code></pre>
</div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["quarter"],"name":[1],"type":["date"],"align":["right"]},{"label":["clicks"],"name":[2],"type":["int"],"align":["right"]},{"label":["impressions"],"name":[3],"type":["int"],"align":["right"]},{"label":["ctr"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["position"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["pages"],"name":[6],"type":["int"],"align":["right"]},{"label":["queries"],"name":[7],"type":["int"],"align":["right"]}],"data":[{"1":"2020-10-01","2":"4","3":"89","4":"0.04494382","5":"9.191011","6":"3","7":"5"},{"1":"2021-01-01","2":"80","3":"2608","4":"0.03067485","5":"8.855061","6":"33","7":"71"},{"1":"2021-04-01","2":"464","3":"16597","4":"0.02795686","5":"6.794360","6":"78","7":"345"},{"1":"2021-07-01","2":"1224","3":"54718","4":"0.02236924","5":"7.350342","6":"126","7":"1158"},{"1":"2021-10-01","2":"2160","3":"112025","4":"0.01928141","5":"7.175023","6":"141","7":"1923"},{"1":"2022-01-01","2":"2816","3":"142337","4":"0.01978403","5":"6.819112","6":"150","7":"2369"},{"1":"2022-04-01","2":"357","3":"17905","4":"0.01993856","5":"6.990896","6":"126","7":"868"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<h4 id="agregace-po-kalendářních-týdnech">Agregace po kalendářních týdnech</h4>
<p>S připravenými funkcemi již mohu snadno agregovat.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>sc_aggregate_all_metrics</span><span class='op'>(</span><span class='st'>"week"</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>week</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2021-08-01"</span><span class='op'>)</span>, <span class='st'>"week"</span><span class='op'>)</span><span class='op'>)</span> |&gt;
  <span class='fu'>sc_reshape</span><span class='op'>(</span><span class='op'>)</span> |&gt;
  <span class='fu'>sc_plot</span><span class='op'>(</span><span class='st'>"4 weeks"</span>, <span class='st'>"%x"</span>, <span class='st'>"week"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-22-1.png" width="624" /></p>
</div>
<h4 id="agregace-po-kalendářních-měsících">Agregace po kalendářních měsících</h4>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>sc_aggregate_all_metrics</span><span class='op'>(</span><span class='st'>"month"</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span>
    <span class='va'>month</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2021-08-01"</span><span class='op'>)</span>, <span class='st'>"month"</span><span class='op'>)</span>,
    <span class='va'>month</span> <span class='op'>&lt;=</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2022-03-01"</span><span class='op'>)</span>, <span class='st'>"month"</span><span class='op'>)</span>
  <span class='op'>)</span> |&gt;
  <span class='fu'>sc_reshape</span><span class='op'>(</span><span class='op'>)</span> |&gt;
  <span class='fu'>sc_plot</span><span class='op'>(</span><span class='st'>"month"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-23-1.png" width="624" /></p>
</div>
<h3 id="průměr-za-kalendářní-týdny">Průměr za kalendářní týdny</h3>
<p>Průměr za kalendářní týdny je výpočetně mnohem jednodušší. Stačí spočítat průměry všech číselných hodnot. Jak ale píšu výše, pro CTR a pozice je metodicky nesprávný, a proto někdy méně a jindy více nepřesný, a u počtů stránek a dotazů sice metodicky dává smysl, nicméně říká něco jiného.</p>
<p>Když si porovnáte tvar křivek metrik <em>pages</em> a <em>queies</em>, jsou sice podobné, ale čísla jsou úplně jiná – v prvním výpočtu (počet za týden) jsem se dostal na 110 stránek a 800 dotazů, kdežto v druhém (průměr týdenního počtu) jen na 80 resp. 300.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_all_metrics_by_date</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>week <span class='op'>=</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='st'>"week"</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>week</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2021-08-01"</span><span class='op'>)</span>, <span class='st'>"week"</span><span class='op'>)</span><span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>week</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span><span class='va'>clicks</span><span class='op'>:</span><span class='va'>queries</span>, <span class='va'>mean</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'>sc_reshape</span><span class='op'>(</span><span class='op'>)</span> |&gt; 
  <span class='fu'>sc_plot</span><span class='op'>(</span><span class='st'>"4 weeks"</span>, <span class='st'>"%x"</span>, <span class='st'>"week"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-24-1.png" width="624" /></p>
</div>
<h3 id="rozsah-hodnot-za-týden">Rozsah hodnot za týden</h3>
<p>Na tomto grafu vykreslím medián jako čáru, mezikvartilové rozpětí (<a href="https://en.wikipedia.org/wiki/Interquartile_range">interquartile range</a>, tj. rozsah mezi 1. a 3. kvartilem) jako tmavší pás a variační rozpětí (rozdíl mezi maximem a minimem) jako světlejší pás.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_all_metrics_by_date</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>week <span class='op'>=</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='st'>"week"</span><span class='op'>)</span>, .before <span class='op'>=</span> <span class='va'>date</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>week</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2021-08-01"</span><span class='op'>)</span>, <span class='st'>"week"</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>date</span><span class='op'>)</span> |&gt; 
  <span class='fu'>sc_reshape</span><span class='op'>(</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>week</span>, <span class='va'>metric</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    median <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span>,
    lower <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span><span class='op'>(</span><span class='va'>value</span>, probs <span class='op'>=</span> <span class='fl'>0.25</span><span class='op'>)</span>,
    upper <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span><span class='op'>(</span><span class='va'>value</span>, probs <span class='op'>=</span> <span class='fl'>0.75</span><span class='op'>)</span>,
    min <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span>,
    max <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span>,
    .groups <span class='op'>=</span> <span class='st'>"drop"</span>
  <span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>week</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_ribbon.html'>geom_ribbon</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>ymin <span class='op'>=</span> <span class='va'>min</span>, ymax <span class='op'>=</span> <span class='va'>max</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"gray80"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_ribbon.html'>geom_ribbon</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>ymin <span class='op'>=</span> <span class='va'>lower</span>, ymax <span class='op'>=</span> <span class='va'>upper</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"gray60"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>median</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"gray25"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_date.html'>scale_x_date</a></span><span class='op'>(</span>
    date_breaks <span class='op'>=</span> <span class='st'>"4 weeks"</span>, date_labels <span class='op'>=</span> <span class='st'>"%x"</span>, date_minor_breaks <span class='op'>=</span> <span class='st'>"week"</span>,
    expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span><span class='fl'>0.025</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span><span class='va'>metric</span>, ncol <span class='op'>=</span> <span class='fl'>1</span>, scales <span class='op'>=</span> <span class='st'>"free_y"</span>, strip.position <span class='op'>=</span> <span class='st'>"right"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-25-1.png" width="624" /></p>
</div>
<h3 id="klouzavý-průměr-moving-average">Klouzavý průměr (moving average)</h3>
<p>Klouzavý průměr za posledních sedm dní zpopularizovaly různé covidové statistiky, ale pro data Search Console obvykle nemá smysl. Hodí se jen v případě, že potřebujete znát co nejnovější hodnotu (typicky včerejší) očištěnou od týdenní sezónnosti, přestože týden ještě neskončil.</p>
<p>Pro jistotu ukážu, jak jde klouzavý průměr za posledních 7 dní spočítat (zde jen imprese), přestože ho sám nepoužívám. Pod něj zároveň šedou barvou vykreslím skutečné imprese po dnech.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_by_date</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    impressions_avg7 <span class='op'>=</span> <span class='fu'>slider</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/slider/man/slide.html'>slide_dbl</a></span><span class='op'>(</span><span class='va'>impressions</span>, <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>)</span>, .before <span class='op'>=</span> <span class='fl'>6</span><span class='op'>)</span>
  <span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>impressions</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"gray"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>impressions_avg7</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_date.html'>scale_x_date</a></span><span class='op'>(</span>
    date_breaks <span class='op'>=</span> <span class='st'>"3 months"</span>, date_labels <span class='op'>=</span> <span class='st'>"%b %y"</span>, 
    date_minor_breaks <span class='op'>=</span> <span class='st'>"month"</span>, expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span><span class='fl'>0.01</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-26-1.png" width="624" /></p>
</div>
<h3 id="regrese">Regrese</h3>
<p>V praxi je úplně nejjednodušší vyhledit denní křivku nějakou regresí. V balíčku <em>ggplot2</em> je na to hotový <code>geom_smooth</code>.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_by_date</span> |&gt;
  <span class='fu'>sc_reshape</span><span class='op'>(</span><span class='op'>)</span> |&gt;
  <span class='fu'>sc_plot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_smooth.html'>geom_smooth</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-27-1.png" width="624" /></p>
</div>
<p>Pokud chci křivku klikatější, jde to nastavit parametrem <code>span</code>.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_by_date</span> |&gt;
  <span class='fu'>sc_reshape</span><span class='op'>(</span><span class='op'>)</span> |&gt;
  <span class='fu'>sc_plot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_smooth.html'>geom_smooth</a></span><span class='op'>(</span>span <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-28-1.png" width="624" /></p>
</div>
<p>A ještě ukážu, jak jde <code>geom_smooth</code> vykreslit na jediné metrice za kratší období, protože to je typ grafu, který asi používám v různých reportech pro klienty nejčastěji. Šedý pás okolo modré křivky je <a href="https://cs.wikipedia.org/wiki/Interval_spolehlivosti">konfidenční interval</a>.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_by_date</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>date</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2022-01-01"</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>date</span>, y <span class='op'>=</span> <span class='va'>impressions</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"gray50"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_smooth.html'>geom_smooth</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_date.html'>scale_x_date</a></span><span class='op'>(</span>date_labels <span class='op'>=</span> <span class='st'>"%b %y"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-29-1.png" width="624" data-distill-preview=1 /></p>
</div>
<h2 id="poměrové-metriky">Poměrové metriky</h2>
<p>Z předešlých grafů už vím, že imprese i kliky dlouhodobě rostou a že to je mj. dáno tím, že roste počet vstupních stránek a dotazů. Tahle informace mi ale nestačí. Existují totiž tři možné varianty:</p>
<ol type="1">
<li>Imprese a kliky rostou víc, než by odpovídalo nárůstu počtu stránek a dotazů. To by se mi líbilo nejvíc, protože by to znamenalo, že novější stránky resp. dotazy jsou úspěšnější než starší, případně se na růstu impresí a kliků podílí ještě něco jiného, např. celková síla webu.</li>
<li>Rúst impresí a kliků zhruba odpovídá růstu počtu stránek a dotazů. To je neutrální výsledek – odměna za vynaloženou práci na obsahu (a tedy efektivita této práce) zůstává pořád zhruba stejná, ani neklesá, ani se nezvyšuje.</li>
<li>Poslední varianta je nejhorší: imprese a kliky rostou méně, než by odpovídalo nárůstu počtu stránek a dotazů. Efektivita vložené práce se tedy zhoršuje. Někdy to jinak nejde, protože nízko visíci ovoce je už otrhané, ale je dobré o tom vědět.</li>
</ol>
<p>Na tyhle otázky pomáhají najít odpověď poměrové metriky. V principu jde o poměry počtu impresí a kliků na jedné straně a počtu stránek a dotazů na straně druhé. Navíc je zajímavý i poměr počtu dotazů na stránku.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>sc_aggregate_all_metrics</span><span class='op'>(</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>week</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2021-08-01"</span><span class='op'>)</span>, <span class='st'>"week"</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>transmute</a></span><span class='op'>(</span>
    week <span class='op'>=</span> <span class='va'>week</span>,
    impressions_per_page <span class='op'>=</span> <span class='va'>impressions</span> <span class='op'>/</span> <span class='va'>pages</span>,
    clicks_per_page <span class='op'>=</span> <span class='va'>clicks</span> <span class='op'>/</span> <span class='va'>pages</span>,
    impressions_per_query <span class='op'>=</span> <span class='va'>impressions</span> <span class='op'>/</span> <span class='va'>queries</span>,
    clicks_per_query <span class='op'>=</span> <span class='va'>clicks</span> <span class='op'>/</span> <span class='va'>queries</span>,
    queries_per_page <span class='op'>=</span> <span class='va'>queries</span> <span class='op'>/</span> <span class='va'>pages</span>
  <span class='op'>)</span> |&gt;
  <span class='fu'>sc_reshape</span><span class='op'>(</span><span class='op'>)</span> |&gt; 
  <span class='fu'>sc_plot</span><span class='op'>(</span><span class='st'>"4 weeks"</span>, <span class='st'>"%x"</span>, <span class='st'>"week"</span>, strip_pos <span class='op'>=</span> <span class='st'>"top"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-30-1.png" width="624" /></p>
</div>
<p>Z grafu je vidět, že počty impresí a kliků na stránku stále rostou, což je dobře – odpovídá to variantě 1. S impresemi a kliky na dotaz je to už slabší, ty posledních cca 5 měsíců stagnují. Co to znamená? Na to odpovídá poslední poměrová metrika, počet dotazů na stránku. Ta roste, což znamená, že novější stránky jsou efektivnější především proto, že pokrývají víc dotazů, avšak jednotlivé novéjší dotazy jsou efektivní zhruba stejně.</p>
<p>K tomu jen poznámka: Grafy samy o sobě nejsou důkazem tvrzení, která zde píšu. Jsou jen dobrým podkladem k odbornému odhadu, který je tím spolehlivější, čím lépe znám daný web a jeho historii.</p>
<h2 id="metriky-podle-pozic">Metriky podle pozic</h2>
<p>Oblíbené vizualizace jsou různé metriky podle pozic nebo intervalů pozic. Např. Collabim a Marketing Miner nabízí graf počtu dotazů podle skupin pozic. I takové grafy jsou ze Search Console udělat.</p>
<h3 id="počet-dotazů-podle-intervalů-pozic">Počet dotazů podle intervalů pozic</h3>
<p>V Collabimu a Marketing Mineru je 100% plošný graf počtu dotazů podle intervalů pozic. Ten v principu vypadá takhle, byť má intervaly pozic nastavené jinak:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_by_date_query</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>date</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2021-08-01"</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    pos_int <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cut.html'>cut</a></span><span class='op'>(</span>
      <span class='va'>position</span>,
      breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span> <span class='op'>*</span> <span class='fl'>0</span><span class='op'>:</span><span class='fl'>3</span>, <span class='cn'>Inf</span><span class='op'>)</span>,
      labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"1-10"</span>, <span class='st'>"11-20"</span>, <span class='st'>"21-30"</span>, <span class='st'>"31+"</span><span class='op'>)</span>
    <span class='op'>)</span>
  <span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='va'>pos_int</span><span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>queries <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>query</span><span class='op'>)</span><span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>queries <span class='op'>=</span> <span class='va'>queries</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>queries</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>date</span>, y <span class='op'>=</span> <span class='va'>queries</span>, fill <span class='op'>=</span> <span class='va'>pos_int</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_ribbon.html'>geom_area</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_date.html'>scale_x_date</a></span><span class='op'>(</span>
    date_breaks <span class='op'>=</span> <span class='st'>"3 months"</span>, date_labels <span class='op'>=</span> <span class='st'>"%b %y"</span>, 
    date_minor_breaks <span class='op'>=</span> <span class='st'>"month"</span>, expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span><span class='fl'>0.01</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_brewer</a></span><span class='op'>(</span>type <span class='op'>=</span> <span class='st'>"seq"</span>, direction <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-31-1.png" width="624" /></p>
</div>
<p>Tenhle graf má ale význam jen pro pevně danou sadu dotazů, která se v čase nemění. V kontextu Search Console, kde se dotazy a jejich počet každý den mění, nedává příliš smysl. O trochu užitečnější je graf skutečných počtů dotazů nepřepočítaných na procenta. Z toho je alespoň vidět, že počet dotazů roste a růst táhnou dotazy v první desítce.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_by_date_query</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>date</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2021-08-01"</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    pos_int <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cut.html'>cut</a></span><span class='op'>(</span>
      <span class='va'>position</span>,
      breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span> <span class='op'>*</span> <span class='fl'>0</span><span class='op'>:</span><span class='fl'>3</span>, <span class='cn'>Inf</span><span class='op'>)</span>,
      labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"1-10"</span>, <span class='st'>"11-20"</span>, <span class='st'>"21-30"</span>, <span class='st'>"31+"</span><span class='op'>)</span>
    <span class='op'>)</span>
  <span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='va'>pos_int</span><span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>queries <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>query</span><span class='op'>)</span>, .groups <span class='op'>=</span> <span class='st'>"drop"</span><span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>date</span>, y <span class='op'>=</span> <span class='va'>queries</span>, fill <span class='op'>=</span> <span class='va'>pos_int</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_ribbon.html'>geom_area</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_date.html'>scale_x_date</a></span><span class='op'>(</span>
    date_breaks <span class='op'>=</span> <span class='st'>"3 months"</span>, date_labels <span class='op'>=</span> <span class='st'>"%b %y"</span>, 
    date_minor_breaks <span class='op'>=</span> <span class='st'>"month"</span>, expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span><span class='fl'>0.01</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_brewer</a></span><span class='op'>(</span>type <span class='op'>=</span> <span class='st'>"seq"</span>, direction <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-32-1.png" width="624" /></p>
</div>
<h3 id="počet-vstupních-stránek-podle-intervalů-pozic">Počet vstupních stránek podle intervalů pozic</h3>
<p>Obdobný graf lze vykreslit i pro počty vstupních stránek</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_by_date_page</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>date</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2021-08-01"</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    pos_int <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cut.html'>cut</a></span><span class='op'>(</span>
      <span class='va'>position</span>,
      breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span> <span class='op'>*</span> <span class='fl'>0</span><span class='op'>:</span><span class='fl'>3</span>, <span class='cn'>Inf</span><span class='op'>)</span>,
      labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"1-10"</span>, <span class='st'>"11-20"</span>, <span class='st'>"21-30"</span>, <span class='st'>"31+"</span><span class='op'>)</span>
    <span class='op'>)</span>
  <span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='va'>pos_int</span><span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>pages <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>page</span><span class='op'>)</span>, .groups <span class='op'>=</span> <span class='st'>"drop"</span><span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>date</span>, y <span class='op'>=</span> <span class='va'>pages</span>, fill <span class='op'>=</span> <span class='va'>pos_int</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_ribbon.html'>geom_area</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_date.html'>scale_x_date</a></span><span class='op'>(</span>
    date_breaks <span class='op'>=</span> <span class='st'>"3 months"</span>, date_labels <span class='op'>=</span> <span class='st'>"%b %y"</span>, 
    date_minor_breaks <span class='op'>=</span> <span class='st'>"month"</span>, expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span><span class='fl'>0.01</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_brewer</a></span><span class='op'>(</span>type <span class='op'>=</span> <span class='st'>"seq"</span>, direction <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-33-1.png" width="624" /></p>
</div>
<h3 id="imprese-podle-intervalů-pozic">Imprese podle intervalů pozic</h3>
<p>Graf jde vykreslit i pro imprese nebo kliky (zde imprese). Zároveň jsem mu nastavil i jiné intervaly pozic, aby bylo vidět pordobnější rozdělení pozic na první stránce výsledků hledání.</p>
<p>Ale upřímně, všechny tyhle grafy mají z dat Search Console málokdy smysl, protože bývají pro většinu webů hodně podobné a nějaký důležitý vhled z nich získám jen výjimečně.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_by_date_query</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>date</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2021-08-01"</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    pos_int <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cut.html'>cut</a></span><span class='op'>(</span>
      <span class='va'>position</span>,
      breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>1.5</span>, <span class='fl'>3.5</span>, <span class='fl'>5.5</span>, <span class='fl'>10.01</span>, <span class='cn'>Inf</span><span class='op'>)</span>,
      labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"1"</span>, <span class='st'>"2-3"</span>, <span class='st'>"4-5"</span>, <span class='st'>"6-10"</span>, <span class='st'>"10+"</span><span class='op'>)</span>,
      right <span class='op'>=</span> <span class='cn'>FALSE</span>
    <span class='op'>)</span>
  <span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='va'>pos_int</span><span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>impressions <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>impressions</span><span class='op'>)</span>, .groups <span class='op'>=</span> <span class='st'>"drop"</span><span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>date</span>, y <span class='op'>=</span> <span class='va'>impressions</span>, fill <span class='op'>=</span> <span class='va'>pos_int</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_ribbon.html'>geom_area</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_date.html'>scale_x_date</a></span><span class='op'>(</span>
    date_breaks <span class='op'>=</span> <span class='st'>"3 months"</span>, date_labels <span class='op'>=</span> <span class='st'>"%b %y"</span>, 
    date_minor_breaks <span class='op'>=</span> <span class='st'>"month"</span>, expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span><span class='fl'>0.01</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_brewer</a></span><span class='op'>(</span>type <span class='op'>=</span> <span class='st'>"seq"</span>, direction <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-34-1.png" width="624" /></p>
</div>
<h2 id="porovnání-metrik-s-předešlým-obdobím-nebo-rokem">Porovnání metrik s předešlým obdobím nebo rokem</h2>
<p>Dalším populárním grafem je porovnání běžného období s obdobím před rokem (YoY, year over year) nebo s obdobím bezprostředně předcházejícím.</p>
<h3 id="meziroční-porovnání-yoy">Meziroční porovnání (YoY)</h3>
<p>Princip přípravy je jednoduchý. Vím, že mám v dlouhé tabulce 6 metrik, takže ke každému řádku přidám funkcí <code>lag</code> hodnotu z řádku o 6 * 365 řádků zpátky. Tuhle hodnotu pak vykreslím tečkovanou čárou.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_all_metrics_by_date</span> |&gt; 
  <span class='fu'>sc_reshape</span><span class='op'>(</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>value_prev <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/lead-lag.html'>lag</a></span><span class='op'>(</span><span class='va'>value</span>, <span class='fl'>6</span> <span class='op'>*</span> <span class='fl'>365</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>date</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2022-01-01"</span><span class='op'>)</span><span class='op'>)</span> |&gt;
  <span class='fu'>sc_plot</span><span class='op'>(</span><span class='st'>"month"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>value_prev</span><span class='op'>)</span>, linetype <span class='op'>=</span> <span class='st'>"dotted"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-35-1.png" width="624" /></p>
</div>
<h3 id="posledních-12-týdnů-a-12-týdnů-před-tím">Posledních 12 týdnů a 12 týdnů před tím</h3>
<p>Obdobně jde vykreslit jakékoli období s jakoukoli granularitou a k němu stejně dlouhé období bezprostředně předcházející.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>sc_aggregate_all_metrics</span><span class='op'>(</span><span class='st'>"week"</span><span class='op'>)</span> |&gt; 
  <span class='fu'>sc_reshape</span><span class='op'>(</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>value_prev <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/lead-lag.html'>lag</a></span><span class='op'>(</span><span class='va'>value</span>, <span class='fl'>6</span> <span class='op'>*</span> <span class='fl'>12</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>week</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2022-01-03"</span><span class='op'>)</span>, <span class='st'>"week"</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'>sc_plot</span><span class='op'>(</span><span class='st'>"2 weeks"</span>, <span class='st'>"%x"</span>, <span class='st'>"week"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>value_prev</span><span class='op'>)</span>, linetype <span class='op'>=</span> <span class='st'>"dotted"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-36-1.png" width="624" /></p>
</div>
<h3 id="autokorelace">Autokorelace</h3>
<p>Zajímavá varianta je, když se vykreslí jen rozdíly (případně podíly resp. procenta) mezi aktuální a předešlou hodnotou. V principu se jedná o svislou úsečku mezi plnou a tečkovanou z grafů výše, která má základ v nule.</p>
<p>Zde je příklad posledních 12 týdnů v porovnání s předešlými 12 týdny vykreslený po dnech. Ukazuje, o kolik byla daná metrika v daný den vyšší než před 12 týdny.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_all_metrics_by_date</span> |&gt;
  <span class='fu'>sc_reshape</span><span class='op'>(</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>value <span class='op'>=</span> <span class='va'>value</span> <span class='op'>-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/lead-lag.html'>lag</a></span><span class='op'>(</span><span class='va'>value</span>, <span class='fl'>6</span> <span class='op'>*</span> <span class='fl'>7</span> <span class='op'>*</span> <span class='fl'>12</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>date</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2022-01-01"</span><span class='op'>)</span><span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>date</span>, y <span class='op'>=</span> <span class='va'>value</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xend <span class='op'>=</span> <span class='va'>date</span>, yend <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_date.html'>scale_x_date</a></span><span class='op'>(</span>date_breaks <span class='op'>=</span> <span class='st'>"month"</span>, date_labels <span class='op'>=</span> <span class='st'>"%b %y"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span><span class='va'>metric</span>, ncol <span class='op'>=</span> <span class='fl'>1</span>, scales <span class='op'>=</span> <span class='st'>"free_y"</span>, strip.position <span class='op'>=</span> <span class='st'>"right"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-37-1.png" width="624" /></p>
</div>
<h2 id="dny-v-týdnu">Dny v týdnu</h2>
<p>Pro většinu webů je typická týdenní periodicita. Někde je slabší, někde silnější a liší se i její průběh. Asi nejlepším porovnáním je <a href="https://cs.wikipedia.org/wiki/Boxplot">boxplot</a>, který ukazuje jednak medián (tlustší vodorovná čára uvnitř boxu) a jednak i celou distribuci hodnt (box reprezentuje 50 % hodnot uprostřed, box i s fousy rozpětí bez odlehlých hodnot, které reprezentují puntíky).</p>
<p>Graf má smysl spíš jen pro imprese a kliky, protože u ostatních metrik se periodicita moc neprojevuje.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_by_date</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>date</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2021-08-01"</span><span class='op'>)</span><span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>ctr</span>, <span class='va'>position</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'>sc_reshape</span><span class='op'>(</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>day <span class='op'>=</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/day.html'>wday</a></span><span class='op'>(</span><span class='va'>date</span>, label <span class='op'>=</span> <span class='cn'>TRUE</span>, week_start <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>day</span>, y <span class='op'>=</span> <span class='va'>value</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_boxplot.html'>geom_boxplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span><span class='va'>metric</span>, ncol <span class='op'>=</span> <span class='fl'>1</span>, scales <span class='op'>=</span> <span class='st'>"free_y"</span>, strip.position <span class='op'>=</span> <span class='st'>"right"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-38-1.png" width="624" /></p>
</div>
<p>Z grafu je vidět, že zrovna tenhle web silnou týdenní periodicitu nemá. Sice od pondělí trochu vystoupá do úterý, pak až do soboty mírně klesá a znovu stoupne v neděli, ale rozdíly hodnot nejsou moc přesvědčivé.</p>
<h3 id="dekompozice-časové-řady">Dekompozice časové řady</h3>
<p>Pro dekompozici časových řad na trend, sezónnost a šum existuje mnoho teoretických modelů a balíčků, které je počítají. Pro příklad ukážu postup s balíčkem <em>feasts</em> z rodiny balíčku <em>tsibble</em>. Ten sice nějakou sezónnost našel, ale zároveň ukazuje, že se pohybuje jen v rozpětí cca 100 impresí (-50 až 50), což v objemu nějakých 2000 impresí za den není zrovna moc. Navíc je vidět, že rozpětí šumu (označený jako <em>random</em>) je čtyřikrát větší.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_by_date</span> |&gt;
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>date</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2022-01-01"</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://tsibble.tidyverts.org/reference/as-tsibble.html'>as_tsibble</a></span><span class='op'>(</span>index <span class='op'>=</span> <span class='va'>date</span><span class='op'>)</span> |&gt;
  <span class='fu'>fabletools</span><span class='fu'>::</span><span class='fu'><a href='https://fabletools.tidyverts.org/reference/model.html'>model</a></span><span class='op'>(</span><span class='fu'>feasts</span><span class='fu'>::</span><span class='fu'><a href='https://feasts.tidyverts.org/reference/classical_decomposition.html'>classical_decomposition</a></span><span class='op'>(</span><span class='va'>impressions</span><span class='op'>)</span><span class='op'>)</span> |&gt;
  <span class='fu'>fabletools</span><span class='fu'>::</span><span class='fu'><a href='https://generics.r-lib.org/reference/components.html'>components</a></span><span class='op'>(</span><span class='op'>)</span> |&gt;
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/autoplot.html'>autoplot</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-39-1.png" width="624" /></p>
</div>
<p>Nutno poznamenat, že sezónnost v v rámci roku nejde z dat Search Console odvodit, protože je k dispozici jen 16 měsíců dat. Museli byste si data sami archivovat za delší období.</p>
<h2 id="segmentace-podle-url">Segmentace podle URL</h2>
<p>Date Search Console se nejčastěji segmentují podle skupin vstupních stránek (URL) nebo podle skupin dotazů. Většinou segmentuju aktuální stav (tj. např. posledních 28 dní) sloupcovým grafem, ale vývoj v čase se občas hodí taky.</p>
<p>V tomto konkrétním případě se v URL hned za doménou nachází složka representující kategorii (rubriku či sekci webu), takže se nabízí segmentace stránek podle těchto kategorií. Dále jde segmentovat i podle typu stránky – na webu jsou jednak stránky rubrik se seznamem článků (ty mají za doménou jen jedno lomítko) a jednak články, které mají za doménou dvě lomítka.</p>
<h3 id="typ-stránky-rubriky-vs.-články">Typ stránky: rubriky vs. články</h3>
<p>Vyjdu z datasetu <code>sc_by_date_page</code> a doplním ho o sloupec reprezentující typ stránky. Imprese a kliky sečtu za měsíc a rubriku a přidám i počet unikátních stránek. Výsledek vykreslím jako vrstvený plošný graf (stacked area chart). Rubriku poznám tak, že má v URL celkem 3 lomítka, kdežto článek má 4. Tím se mi do rubrik dostane i homepage, ale to mi nevadí.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_by_date_page</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/between.html'>between</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2021-01-01"</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2022-03-31"</span><span class='op'>)</span><span class='op'>)</span>,
  <span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    page_type <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='fu'><a href='https://stringr.tidyverse.org/reference/str_count.html'>str_count</a></span><span class='op'>(</span><span class='va'>page</span>, <span class='st'>"/"</span><span class='op'>)</span> <span class='op'>==</span> <span class='fl'>3</span>, <span class='st'>"rubrika"</span>, <span class='st'>"článek"</span><span class='op'>)</span>,
    month <span class='op'>=</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='st'>"month"</span><span class='op'>)</span>
  <span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>month</span>, <span class='va'>page_type</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    n <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>page</span><span class='op'>)</span>,
    impressions <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>impressions</span><span class='op'>)</span>,
    clicks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>clicks</span><span class='op'>)</span>,
    .groups <span class='op'>=</span> <span class='st'>"drop"</span>
  <span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='va'>n</span><span class='op'>:</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/everything.html'>last_col</a></span><span class='op'>(</span><span class='op'>)</span>, names_to <span class='op'>=</span> <span class='st'>"metric"</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>month</span>, y <span class='op'>=</span> <span class='va'>value</span>, fill <span class='op'>=</span> <span class='va'>page_type</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_ribbon.html'>geom_area</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>metric</span>, ncol <span class='op'>=</span> <span class='fl'>1</span>, scales <span class='op'>=</span> <span class='st'>"free_y"</span>, strip.position <span class='op'>=</span> <span class='st'>"right"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_brewer</a></span><span class='op'>(</span>type <span class='op'>=</span> <span class='st'>"qual"</span>, palette <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-40-1.png" width="624" /></p>
</div>
<p>Výsledek je jednoznačný: rubrik je oproti článkům velmi málo a na viditelnosti nebo návštěvnosti z Googlu se reálně nepodílejí.</p>
<h3 id="rubriky">Rubriky</h3>
<p>Rubriky identifikuje první složka za doménou, takže ji stačí z URL vykousnout funkcí <code>str_extract</code> z balíčku <em>stringr</em>, které pošlu jen cestu za doménou získanou funkcí <code>path</code> z balíčku <em>urltools</em>. Homepage vyřadím (má ve sloupci <code>category</code> hodnotu <code>NA</code>).</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_by_date_page</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    category <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_extract.html'>str_extract</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/urltools/man/path.html'>path</a></span><span class='op'>(</span><span class='va'>page</span><span class='op'>)</span>, <span class='st'>"^[^/]+"</span><span class='op'>)</span>,
    month <span class='op'>=</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='st'>"month"</span><span class='op'>)</span>
  <span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/between.html'>between</a></span><span class='op'>(</span><span class='va'>month</span>, <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2021-01-01"</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2022-03-31"</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>category</span><span class='op'>)</span>
  <span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>month</span>, <span class='va'>category</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    n <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>page</span><span class='op'>)</span>,
    impressions <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>impressions</span><span class='op'>)</span>,
    clicks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>clicks</span><span class='op'>)</span>,
    .groups <span class='op'>=</span> <span class='st'>"drop"</span>
  <span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='va'>n</span><span class='op'>:</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/everything.html'>last_col</a></span><span class='op'>(</span><span class='op'>)</span>, names_to <span class='op'>=</span> <span class='st'>"metric"</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>month</span>, y <span class='op'>=</span> <span class='va'>value</span>, fill <span class='op'>=</span> <span class='va'>category</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_ribbon.html'>geom_area</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>metric</span>, ncol <span class='op'>=</span> <span class='fl'>1</span>, scales <span class='op'>=</span> <span class='st'>"free_y"</span>, strip.position <span class='op'>=</span> <span class='st'>"right"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_brewer</a></span><span class='op'>(</span>type <span class='op'>=</span> <span class='st'>"qual"</span>, palette <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-41-1.png" width="624" /></p>
</div>
<p>Tady už je interpretace zajímavější.</p>
<ul>
<li>Stránek v rubrice <em>značky</em> je hodně, ale impresí a kliků mají málo. Lze je tedy považovat za nepříliš úspěšné. Obdobně je na tom <em>katalog</em>.</li>
<li>Opakem jsou <em>trendy</em>, které mají velmi málo stránek, ale získávají hodně impresí i kliků.</li>
<li>Rubriky <em>nákupy</em> a <em>materiály</em> mají hodně impresí, ale z hlediska viditelnosti <em>nákupy</em> fungují efektivněji, protože impresí dosahují s menším počtem stránek. Zase ale mají horší CTR.</li>
<li>Zajímavá je rubirka <em>m</em> (magazín), která má hodně kliků při menším počtu impresí (takže vysoké CTR) a navíc jí kliky v posledních měsících rychle rostou i při stagnujícím počtu stránek.</li>
</ul>
<p>Aby byla efektivita výkonových metrik (kliky a imprese) vzhledem k počtu unikátních stránek vidět ještě lépe, lze použít poměrové metriky: počet impresí na stránku a počet kliků na stránku.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sc_by_date_page</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    category <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_extract.html'>str_extract</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/urltools/man/path.html'>path</a></span><span class='op'>(</span><span class='va'>page</span><span class='op'>)</span>, <span class='st'>"^[^/]+"</span><span class='op'>)</span>,
    month <span class='op'>=</span> <span class='fu'><a href='https://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='st'>"month"</span><span class='op'>)</span>
  <span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/between.html'>between</a></span><span class='op'>(</span><span class='va'>month</span>, <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2021-01-01"</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2022-03-31"</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>category</span><span class='op'>)</span>
  <span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>month</span>, <span class='va'>category</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    impressions_pp <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>impressions</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>page</span><span class='op'>)</span>,
    clicks_pp <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>clicks</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>page</span><span class='op'>)</span>,
    .groups <span class='op'>=</span> <span class='st'>"drop"</span>
  <span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='va'>impressions_pp</span><span class='op'>:</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/everything.html'>last_col</a></span><span class='op'>(</span><span class='op'>)</span>, names_to <span class='op'>=</span> <span class='st'>"metric"</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>month</span>, y <span class='op'>=</span> <span class='va'>value</span>, fill <span class='op'>=</span> <span class='va'>category</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_ribbon.html'>geom_area</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>metric</span>, ncol <span class='op'>=</span> <span class='fl'>1</span>, scales <span class='op'>=</span> <span class='st'>"free_y"</span>, strip.position <span class='op'>=</span> <span class='st'>"right"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_brewer</a></span><span class='op'>(</span>type <span class='op'>=</span> <span class='st'>"qual"</span>, palette <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="search-console-timeline_files/figure-html5/unnamed-chunk-42-1.png" width="624" /></p>
</div>
<p>Zde je ještě lépe vidět malá efektivita značek a katalogu a vysoká efektivita trendů.</p>
<p>Z těchto poznatků jde odvodit docela dost doporučení pro další práci s obsahem, ale to již záleží na konkrétním kontextu projektu.</p>
<p>Podobně jde segemntovat podle dotazů. Nejčastěji se tak rozlišuje brandové hledání od obecného, ale jde zapojit i klasifikace dotazů z analýzy klíčových slov a segementovat podle ní. To už ale přesahuje téma tohoto článku.</p>
<p>A to je všechno :-)</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
